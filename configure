#!/bin/bash

if [ $# -lt 1 ]
then
    cat <<EOF
Usage: configure wireshark_src [output_dir]
  wireshark_src - directory with wireshark source
  output_dir - directory to output plugin
    default: $HOME/.wireshark/plugins
EOF
	exit 1
fi

ws_dir=`readlink -f "$1"`

if [ "$2" ]
then
    out_dir=`readlink -f "$2"`
else
    out_dir="$HOME/.wireshark/plugins"
fi

xml_cflags=`xml2-config --libs`
xml_lflags=`xml2-config --cflags`

# using ^ instead of / because it is very unlikely ^ will show up...
sed -e "s^<WIRESHARK_SRC_ROOT>^${ws_dir}^g" \
    -e "s^<WIRESHARK_OUT>^${out_dir}^g" \
    -e "s^<XML_LFLAGS>^${xml_lflags}^g" \
    -e "s^<XML_CFLAGS>^${xml_cflags}^g" \
    Makefile.in > Makefile

if [ ! -e "$ws_dir/config.h" ]
then
    echo "$ws_dir/config.h does not exist, you really should \
run ./configure in the Wireshark source directory."
    exit 1
fi

